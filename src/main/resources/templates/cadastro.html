<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro - Avalia</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="/css/coordenador.css">
</head>

<body class="body-login">
	<main class="form-signin w-100 m-auto">
		<div class="card border-0 shadow-lg">
			<div class="card-body p-4 p-md-5">
				<form id="formCadastro">
					<div class="text-center mb-4">
						<a class="navbar-brand fw-bold fs-4" href="index.html">
							<i class="bi bi-book-half"></i> Avalia
						</a>
					</div>

					<h1 class="h3 mb-3 fw-normal text-center">Crie sua conta</h1>

					<!-- Nome -->
					<div class="form-floating mb-3">
						<input type="text" class="form-control" id="nome" name="nomeCompleto"
							placeholder="Seu nome completo" required>
						<label for="nome">Nome Completo</label>
					</div>

					<!-- E-mail -->
					<div class="form-floating mb-3">
						<input type="email" class="form-control" id="email" name="email"
							placeholder="nome@exemplo.com" required>
						<label for="email">Endereço de e-mail</label>
					</div>

					<!-- RGM -->
					<div class="form-floating mb-3">
						<input type="text" class="form-control" id="rgm" name="rgm"
							placeholder="Seu RGM" required>
						<label for="rgm">RGM</label>
					</div>

					<!-- Senha -->
					<div class="form-floating mb-3 position-relative">
						<input type="password" class="form-control" id="senha" name="senha"
							placeholder="Senha" required>
						<label for="senha">Senha</label>
						<i class="bi bi-eye-slash password-toggle-icon" id="togglePassword"
							style="position: absolute; right: 15px; top: 15px; cursor: pointer;"></i>
					</div>

					<!-- Confirmar senha -->
					<div class="form-floating mb-3 position-relative">
						<input type="password" class="form-control" id="confirmarSenha"
							name="confirmarSenha" placeholder="Confirme sua senha" required>
						<label for="confirmarSenha">Confirme sua senha</label>
						<i class="bi bi-eye-slash password-toggle-icon" id="toggleConfirmPassword"
							style="position: absolute; right: 15px; top: 15px; cursor: pointer;"></i>
					</div>

					<!-- Botão -->
					<button class="btn btn-primary-custom w-100 py-2" type="submit">Cadastrar</button>

					<hr class="my-4">

					<p class="text-center small">
						Já tem uma conta?
						<a href="login" class="text-decoration-none">Faça login</a>
					</p>

					<!-- Mensagem dinâmica -->
					<div id="mensagemCadastro" class="mt-3 text-center"></div>
				</form>
			</div>
		</div>
	</main>

	<!-- Scripts -->
	<script>
	// --- Mostrar/ocultar senha ---
	const togglePassword = document.querySelector('#togglePassword');
	const password = document.querySelector('#senha');
	togglePassword.addEventListener('click', function () {
		const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
		password.setAttribute('type', type);
		this.classList.toggle('bi-eye');
		this.classList.toggle('bi-eye-slash');
	});

	const toggleConfirmPassword = document.querySelector('#toggleConfirmPassword');
	const confirmPassword = document.querySelector('#confirmarSenha');
	toggleConfirmPassword.addEventListener('click', function () {
		const type = confirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
		confirmPassword.setAttribute('type', type);
		this.classList.toggle('bi-eye');
		this.classList.toggle('bi-eye-slash');
	});

	// --- Enviar formulário via Fetch ---
	document.getElementById("formCadastro").addEventListener("submit", async (event) => {
		event.preventDefault();

		const formData = new FormData(event.target);
		const mensagemDiv = document.getElementById("mensagemCadastro");

		try {
			const response = await fetch("/api/usuarios/cadastrar", {
				method: "POST",
				body: formData
			});

			const result = await response.text();

			if (response.ok) {
				mensagemDiv.innerHTML = `<div class="alert alert-success py-2">${result}</div>`;
				setTimeout(() => window.location.href = "/login", 1500);
			} else {
				mensagemDiv.innerHTML = `<div class="alert alert-warning py-2">${result}</div>`;
			}

		} catch (error) {
			mensagemDiv.innerHTML = `<div class="alert alert-danger py-2">Erro ao cadastrar usuário. Tente novamente.</div>`;
			console.error(error);
		}
	});
	</script>
</body>
</html>
